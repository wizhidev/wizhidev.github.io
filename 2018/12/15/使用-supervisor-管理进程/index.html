<!DOCTYPE html>
<html lang="zh_CN">


<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>
    使用 supervisor 管理进程 | 全干程序员
  </title>
  <meta name="description" content="">
  
  <meta name="keywords" content="
  supervisor 管理进程
  ">
  
  <meta name="author" content="wizhidev&amp;huang">

  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

  <link rel="shortcut icon" type="image/ico" href="/favicon.ico">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/vue/1.0.25-csp/vue.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>
</head>

<body>
<nav>
  <div class="container">
    <a href="/" class="site-logo"><i class="fa fa-github"></i></a>
    <div class="site-search">
      <form onsubmit="return search()">
        <label class="form-control">
          <span class="scope-badge">This website</span>
          <input id="query" type="text" placeholder="Search" value="">
          <span class="scope-badge clear-search"> x </span>
        </label>
      </form>
    </div>
    <ul>
      
      <li><a href="/archives">Archives</a></li>
      
      
      <li><a href="/categories">Categories</a></li>
      
      
      <li><a href="/tags">Tags</a></li>
      
      
      <li><a href="/atom.xml">RSS</a></li>
      
    </ul>
  </div>
</nav>

<main class="container">
  <header>
  <h2>
    <i class="fa fa-book text-muted"></i>
    <a href="/">全干程序员</a>
    
    
  </h2>
  <div class="header-btn">
    <div class="btn-group">
      <a href="/archives" class="btn btn-group-left"><i class="fa fa-file-text"></i> Posts </a>
      <a href="/archives" class="btn btn-group-right"> 9 </a>
    </div>

    <div class="btn-group">
      <a href="/tags" class="btn btn-group-left"><i class="fa fa-tags"></i> Tags </a>
      <a href="/tags" class="btn btn-group-right"> 8 </a>
    </div>

    <div class="btn-group">
      <a href="/categories" class="btn btn-group-left"><i class="fa fa-list-ul"></i> Categories </a>
      <a href="/categories" class="btn btn-group-right"> 0 </a>
    </div>
  </div>
</header>


<div class="boxed-group" xmlns="http://www.w3.org/1999/html">
  <h3>
    <i class="fa fa-user"></i>
     <a>wizhidev&amp;huang</a>
    <span>
      <i class="fa fa-pencil"></i> Published: 2018-12-15 20:51:26
    </span>
  </h3>
  <article>
    <h1>使用 supervisor 管理进程</h1>
    <p>Supervisor (<a href="http://supervisord.org/" target="_blank" rel="noopener">http://supervisord.org</a>) 是一个用 Python 写的进程管理工具，可以很方便的用来启动、重启、关闭进程（不仅仅是 Python 进程）。除了对单个进程的控制，还可以同时启动、关闭多个进程，比如很不幸的服务器出问题导致所有应用程序都被杀死，此时可以用 supervisor 同时启动所有应用程序而不是一个一个地敲命令启动。</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>服务器我采用的是 Ubuntu 系统，所以使用 apt-get 安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install supervisor</span><br></pre></td></tr></table></figure>
<h3 id="supervisor-配置"><a href="#supervisor-配置" class="headerlink" title="supervisor 配置"></a>supervisor 配置</h3><p>安装完成之后，配置文件在 Ubuntu 系统中的位置是 <strong>/etc/supervisor/supervisor.conf</strong>，如果配置文件不存在，可以使用命令<strong>echo supervisord_conf</strong>命令输出默认配置，也可以重定向到一个配置文件里：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo_supervisord_conf &gt; /etc/supervisord.conf</span><br></pre></td></tr></table></figure>
<p>可以看看主要的配置选项</p>
<p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-13-152146.png" alt=""></p>
<h3 id="添加自己的程序"><a href="#添加自己的程序" class="headerlink" title="添加自己的程序"></a>添加自己的程序</h3><p>对应的配置文件可能是：(每行配置结束的“；”一定要和配置项保持分开)</p>
<p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-13-152305.png" alt=""></p>
<p>其中 <code>[program:iot]</code> 中的 <code>iot</code> 是应用程序的唯一标识，不能重复。对该程序的所有操作（start, restart 等）都通过名字来实现。</p>
<h3 id="web-管理界面"><a href="#web-管理界面" class="headerlink" title="web 管理界面"></a>web 管理界面</h3><p>可以配置 supervisrod 启动 web 管理界面，这个 web 后台使用 Basic Auth 的方式进行身份认证。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">;[inet_http_server]         ; HTTP 服务器，提供 web 管理界面</span><br><span class="line">;port=9001        			; Web 管理后台运行的 IP 和端口，如果开放到公网，需要注意安全性</span><br><span class="line">;username=user              ; 登录管理后台的用户名</span><br><span class="line">;password=123               ; 登录管理后台的密码</span><br></pre></td></tr></table></figure>
<p>可以在 web 上，控制任务的启动、停止、重启、清除日志，查看最新的日志记录。</p>
<p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-13-143910.png" alt=""></p>
<h3 id="使用-supervisorctl"><a href="#使用-supervisorctl" class="headerlink" title="使用 supervisorctl"></a>使用 supervisorctl</h3><p>Supervisorctl 是 supervisord 的一个命令行客户端工具，启动时需要指定与 supervisord 使用同一份配置文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supervisorctl -c /etc/supervisord/supervisord.conf</span><br></pre></td></tr></table></figure>
<p>上面这个命令会进入 supervisorctl 的 shell 界面，然后可以执行不同的命令了：</p>
<blockquote>
<p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-15-125846.png" alt=""></p>
</blockquote>

  </article>
</div>




</main>

<footer class="container clearfix">
  <ul class="social-link">
    <li>© 2016 wizhidev&amp;huang</li>

    <li><a href="http://yoursite.com">Home</a></li>
    
  </ul>
  <div class="theme-info">
    Theme <a href="//github.com/sabrinaluo/hexo-theme-replica">Replica</a>
    by <a href="//github.com/sabrinaluo">Hiitea</a> ❤ Powered by Hexo
  </div>
  <a href="http://yoursite.com" class="site-logo"><i class="fa fa-github"></i></a>
</footer>







<script src="/js/main.js"></script>

</body>
</html>
