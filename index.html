<!DOCTYPE html>
<html lang="zh_CN">
  <head><meta name="generator" content="Hexo 3.8.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">

<meta name="theme-color" content="#f8f5ec">
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">















  <link rel="alternate" href="/default" title="PP小猪窝">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.10.1">



<link rel="canonical" href="http://yoursite.com/">



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css">




  <link rel="stylesheet" type="text/css" href="/lib/nprogress/nprogress.min.css">



<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.10.1">



  



  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>









<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":true,"fancybox":true,"pjax":true};
</script>

    <title> PP小猪窝 </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">PP小猪窝</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            首页
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            归档
          
        </li>
      </a>
    
      <a href="/about">
        <li class="mobile-menu-item">
          
          
            关于
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">PP小猪窝</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              首页
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              归档
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/about">
            
            
              关于
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <section id="posts" class="posts">
    
      
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2018/12/15/关于学习/">关于学习</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2018-12-15
        </span>
        
        
      </div>
    </header>

    
    


    <div class="post-content">
      
        
        

        
          <p>什么是读书？<strong>读书是向外的，称之为看。</strong></p>
<p>什么是静坐？<strong>静坐是向内的，称之为观</strong></p>
<h3 id="说看"><a href="#说看" class="headerlink" title="说看"></a>说看</h3><p>优秀的人永远对生活充满好奇心。<strong>对他们来说这不叫 “好奇”，而是刷新认知的边界</strong>。通常来说，一个人的判断决策和行为方式，取决于他的经历和知识。</p>
<p>你对这个世界的认知决定了你在多大的范围内把握机会。它不应该是一种业余爱好，而是你能够<strong>保持思维先进性和机遇洞察的必备手段</strong>。</p>
<p><strong>1、向高人求教。</strong></p>
<p>那些行业的领导者获得的信息比你多，处理信息的能力比你强，吃过的猪肉都跟你吃的不一样，他们比你强不是因为他们聪明，而是具备你不知道的认知。</p>
<p>学会向他们学习。</p>
<p>如果一开始不能理解，就先去尝试，一边尝试一边学习。</p>
<p>有行动就有机会证伪。</p>
<p>在行动中形成认知。</p>
<p>越是处于绝境，越要向外看。</p>
<p><strong>2、尝试从多个角度看待问题。</strong></p>
<p>事实是一样的，但每个人的角度却不一样。</p>
<p>人都很容易陷入以自我为中心的状态，面对新生事物，很容易基于自己过去的认知做出判断。就像诺基亚，抗摔待机时间长，这是他的长处。但也正是基于对过去成功经验的认知，让它错过了一个时代。</p>
<p>尝试从多个角度看待问题，不要以偏概全。</p>
<p><strong>3、持续输入和重构。</strong></p>
<p>高效率的持续输入和重构，会带来对认知的刷新，最终形成高效的正循环。</p>
<h3 id="说观"><a href="#说观" class="headerlink" title="说观"></a>说观</h3><p>向内为观。</p>
<p><strong>大部分的知识是面向不稳定性的。</strong></p>
<p><strong>是在某种情境下经验的总结。</strong></p>
<p>外界的环境变化越快，知识的保质期就越短。</p>
<p><strong>学习并不是知识的积累，而是不断重构自己认识世界的方式。</strong></p>
<p>尤其面对瞬息万变的互联网外部环境。<strong>我们不是去降低这种不稳定性，而是去积极的拥抱它。努力升级自己的操作系统，以应对这种变更带来的影响。</strong></p>
<p>小步快跑、快速迭代。</p>
<p>这句话讲的不是知识，而是方法。</p>

        
      
    </div>

    

    

  </article>

      
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2018/12/15/创业的几点建议/">创业的几点建议</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2018-12-15
        </span>
        
        
      </div>
    </header>

    
    


    <div class="post-content">
      
        
        

        
          <ol>
<li><strong>先兼职完成探索的闭环，赚到第一块钱，兼职完不成赚一块钱的目标，全职也很难</strong>，只有当闭环走完，明显的瓶颈出现在时间投入上时，全职才有意义。</li>
<li><strong>做好至少半年以上没有收入的准备</strong>，特别是做产品，没有几个月的打磨产品，产品是不可用状态，现金压力太大，动作会变形，动作变形，产品做不好，进入恶性循环。</li>
<li>先复制别人的模式，很多看起来轻松简单赚钱的事情，自己动手去试试，就发现没有那么简单，但也不要被吓到，专注的扎进去一段时间，会发现么有那么难。</li>
<li>所谓的人脉、资源没那么靠谱，不要太相信说给你很多资源的人，<strong>只有当你真正的给他们提供不可或缺的价值，他们才会长期的依赖你，本质上都是利益交换</strong></li>
<li>不要迷恋裂变、流量玩法、增长黑客这些概念，从0到1大众一个产品或者商用模式，并把他从0推到1，从1推到1000的能力，这个才是壁垒，光会玩流量是给别人做嫁衣。</li>
<li>不要一上来做平台，先搞定某一个细分市场的某一边，甚至是只要跟某边的关键人建立关系，再逐步长大，放大，成为某边资源的代表，进而去拓展另一边，最后发展成平台，<strong>平台是长出来的，不是规划出来的</strong></li>
</ol>
<h3 id="如何赚钱"><a href="#如何赚钱" class="headerlink" title="如何赚钱"></a>如何赚钱</h3><p>有了需求自然会产生供应者，这就是赚钱的契机。不要看不起任何自认为很 low 的软件，用户量决定市场规模，从用户角度去思考才是最快</p>
<h3 id="什么样的工作才是高薪"><a href="#什么样的工作才是高薪" class="headerlink" title="什么样的工作才是高薪"></a>什么样的工作才是高薪</h3><p>面向用户的应用才是最赚钱的，支付宝和微信这种和用户直接接触，能够改变用户生活习惯的应用才赚钱。</p>

        
      
    </div>

    

    

  </article>

      
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2018/12/15/git-flow工作流/">git-flow工作流</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2018-12-15
        </span>
        
        
      </div>
    </header>

    
    


    <div class="post-content">
      
        
        

        
          <p>git-flow是当前非常流行的项目工作流程，可以在团队中行程一个特定有效的工作流程，解决团队开发中版本控制出现的混乱。</p>
<h3 id="git-flow"><a href="#git-flow" class="headerlink" title="git-flow"></a><strong>git-flow</strong></h3><pre><code>git-flow并不是替代git，它扩展了很多命令，这些命令可以在预定义的顺序下自动执行多个操作。
</code></pre><h3 id="安装方法"><a href="#安装方法" class="headerlink" title="安装方法"></a>安装方法</h3><p>mac平台安装git-flow方法</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install git-flow</span><br></pre></td></tr></table></figure>
<p>其他平台参考链接<a href="https://github.com/nvie/gitflow/wiki/Installation" target="_blank" rel="noopener">安装方法</a></p>
<h3 id="分支管理"><a href="#分支管理" class="headerlink" title="分支管理"></a>分支管理</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">master	线上也是最稳定分支</span><br><span class="line">develop 开发分支 fork from master</span><br><span class="line">feature 团队开发功能分支 fork from develop</span><br><span class="line">release 准备要发布版本的分支, 用来修复 bug fork from develop</span><br><span class="line">hotfix 线上紧急bug---fork from master</span><br></pre></td></tr></table></figure>
<p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-15-132952.png" alt=""></p>
<h2 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h2><h3 id="初始化git-这一步可以直接由git-flow-init命令完成"><a href="#初始化git-这一步可以直接由git-flow-init命令完成" class="headerlink" title="初始化git(这一步可以直接由git flow init命令完成)"></a>初始化git(这一步可以直接由git flow init命令完成)</h3><p>​    <img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-15-133148.png" alt=""></p>
<p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-15-132858.png" alt=""></p>
<blockquote>
<p>强烈建议你使用默认的命名机制，并且一步一步地确定下去。</p>
</blockquote>
<h2 id="功能开发"><a href="#功能开发" class="headerlink" title="功能开发"></a>功能开发</h2><pre><code>对于一个开发人员来说，最平常的工作可能就是功能的开发。这就是为什么 git-flow 定义了很多对于功能开发的工作流程，从而来帮助你有组织地完成它。
</code></pre><h3 id="开发新功能"><a href="#开发新功能" class="headerlink" title="开发新功能"></a>开发新功能</h3><p>开发者hwp开发一个新功能</p>
<p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-15-133107.png" alt=""></p>
<blockquote>
<p>在这些命令的输出文本中，git-flow 会对刚刚完成的操作打印出一个很有帮助的概述</p>
</blockquote>
<p>当你需要帮助的时候，你可以随时请求帮助。例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git flow feature help</span><br></pre></td></tr></table></figure>
<blockquote>
<p>git-flow 会创建一个名为 “feature/hwp-dev” 的分支,git-flwo 会直接checkout到新的分支，这样就可以直接开始工作</p>
</blockquote>
<h3 id="完成功能提交"><a href="#完成功能提交" class="headerlink" title="完成功能提交"></a>完成功能提交</h3><p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-15-133225.png" alt=""></p>
<p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-15-133259.png" alt=""></p>
<blockquote>
<p>这个 “feature finish” 命令会把我们的工作整合到主 “develop” 分支中去，在这里它需要等待：</p>
<ol>
<li>一个在更广泛的 “开发” 背景下的全面测试。（和其他开发者的模块一起测试）</li>
<li>稍后和所有积攒在 “develop” 分支中的其它功能一起进行发布。</li>
</ol>
<p>之后，git-flow 也会进行清理操作。它会删除这个当下已经完成的功能分支，并且换到 “develop” 分支。</p>
</blockquote>
<h3 id="管理release"><a href="#管理release" class="headerlink" title="管理release"></a>管理release</h3><h4 id="创建release"><a href="#创建release" class="headerlink" title="创建release"></a>创建release</h4><p>当你认为现在在 “develop” 分支的代码已经是一个成熟的 release 版本时，这意味着：</p>
<ol>
<li>它包括所有新的功能和必要的修复；</li>
<li>它已经被彻底的测试过了。</li>
</ol>
<p>如果上述两点都满足，那就是时候开始生成一个新的 release 了：</p>
<p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-15-133325.png" alt=""></p>
<blockquote>
<p>在release版本上，准备好正式上线的环境部署，就可以完成版本</p>
</blockquote>
<h3 id="完成release"><a href="#完成release" class="headerlink" title="完成release"></a>完成release</h3><p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-15-133342.png" alt=""></p>
<p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-15-133356.png" alt=""></p>
<blockquote>
<p>这个命令会完成如下一系列的操作：</p>
<ol>
<li>首先，git-flow 会拉取远程仓库，以确保目前是最新的版本。</li>
<li>然后，release 的内容会被合并到 “master” 和 “develop” 两个分支中去，这样不仅产品代码为最新的版本，而且新的功能分支也将基于最新代码。</li>
<li>为便于识别和做历史参考，release 提交会被标记上这个 release 的名字（在我们的例子里是 “1.0”）。</li>
<li>清理操作，版本分支会被删除，并且回到 “develop”。</li>
</ol>
</blockquote>
<p>从 Git 的角度来看，release 版本现在已经完成。依据你的设置，对 “master” 的提交可能已经触发了你所定义的部署流程，或者你可以通过手动部署，来让你的软件产品进入你的用户手中。</p>
<h3 id="管理hotfix"><a href="#管理hotfix" class="headerlink" title="管理hotfix"></a>管理hotfix</h3><p>线上产品出现紧急bug时，使用hotfix工作流程</p>
<h4 id="创建hotfix"><a href="#创建hotfix" class="headerlink" title="创建hotfix"></a>创建hotfix</h4><p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-15-133426.png" alt=""></p>
<blockquote>
<p>因为这是对产品代码进行修复，所以这个 hotfix 分支是基于 “master” 分支</p>
</blockquote>
<h4 id="完成hotfix"><a href="#完成hotfix" class="headerlink" title="完成hotfix"></a>完成hotfix</h4><p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-15-133447.png" alt=""></p>
<p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-15-133503.png" alt=""></p>
<blockquote>
<ol>
<li>完成的改动会被合并到 “master” 中，同样也会合并到 “develop” 分支中，这样就可以确保这个错误不会再次出现在下一个 release 中。</li>
<li>这个 hotfix 程序将被标记起来以便于参考。</li>
<li>这个 hotfix 分支将被删除，然后切换到 “develop” 分支上去。</li>
</ol>
</blockquote>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://www.git-tower.com/learn/git/ebook/cn/command-line/advanced-topics/git-flow" target="_blank" rel="noopener">git-flow工作流</a></p>
<p><a href="https://github.com/xirong/my-git/blob/master/git-workflow-tutorial.md" target="_blank" rel="noopener">git工作流</a></p>

        
      
    </div>

    

    

  </article>

      
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2018/12/15/为什么-pymysql-重连后才能查到新添加的数据/">为什么 pymysql 重连后才能查到新添加的数据</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2018-12-15
        </span>
        
        
      </div>
    </header>

    
    


    <div class="post-content">
      
        
        

        
          <h3 id="背景描述"><a href="#背景描述" class="headerlink" title="背景描述"></a>背景描述</h3><p>项目中需要定时查询最新的环境采集数据，然后推送到 web 页面展示。</p>
<h3 id="还原问题"><a href="#还原问题" class="headerlink" title="还原问题"></a>还原问题</h3><ol>
<li>在 python 中使用了 pymsql 操作 mysql 数据库。</li>
<li>查询数据的时候，从数据库中读取一条数据之后，后面查到的数据永远不变。</li>
<li>只有重启程序重新建立连接之后，才能获取到最新的数据。</li>
</ol>
<h3 id="查询代码"><a href="#查询代码" class="headerlink" title="查询代码"></a>查询代码</h3><p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-13-154104.png" alt=""></p>
<h3 id="查询结果"><a href="#查询结果" class="headerlink" title="查询结果"></a>查询结果</h3><p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-13-154215.png" alt=""></p>
<p>如图所示，查询结果永远是 ID:1835 的数据，此时数据库中的数据是这样的。</p>
<p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-13-154348.png" alt=""></p>
<p>从图中可以看出，新的数据已经增加了好多条，但是查询倒序查询最新的一条，为什么没有变化呢？</p>
<p>先交代解决办法</p>
<h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><h5 id="第一种方案，每次查询后进行commit操作"><a href="#第一种方案，每次查询后进行commit操作" class="headerlink" title="第一种方案，每次查询后进行commit操作"></a>第一种方案，每次查询后进行commit操作</h5><p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-13-154712.png" alt=""></p>
<h5 id="第二种方案，创建connect连接时，autocommit-True，自动进行commit提交"><a href="#第二种方案，创建connect连接时，autocommit-True，自动进行commit提交" class="headerlink" title="第二种方案，创建connect连接时，autocommit=True，自动进行commit提交"></a>第二种方案，创建connect连接时，autocommit=True，自动进行commit提交</h5><p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-13-154806.png" alt=""></p>
<h5 id="第三种方案，关闭数据库的事务（不建议选择这项操作）"><a href="#第三种方案，关闭数据库的事务（不建议选择这项操作）" class="headerlink" title="第三种方案，关闭数据库的事务（不建议选择这项操作）"></a>第三种方案，关闭数据库的事务（不建议选择这项操作）</h5><h3 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h3><p>想要解决上述的问题，首先要明白 mysql 中事务这个概念，本地的 mysql 数据库是默认安装的，默认存储引擎是（InnoDB），事务隔离级别是（REPEATABLE READ）</p>
<p>当前的存储引擎</p>
<p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-13-155905.png" alt=""></p>
<p>当前的事务隔离级别</p>
<p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-13-155941.png" alt=""></p>
<p><strong>重复读（REPEATABLE READ）：</strong></p>
<p>InnoDB 的默认隔离级别。它可以防止任何被查询的行被其他事务更改，从而阻止不可重复的读取，而不是幻读取。以便事务内的所有查询都会查看同一快照中的数据，即数据在事务开始时的数据。</p>
<p>所以遇到的问题原因就是跟当前的事务级别有关系；<strong>当创建查询事务时，事务一直没有进行更新，每次查询到的数据都是之前查询结果的快照</strong></p>
<p>知道了具体原因是事务级别的问题，导致查询事务并没有更新，那么针对事务隔离级别进行应对就可以了，此类问题有三种解决方案，<strong>修改事务隔离级别、每次查询后更新事务（推荐选项）、关闭数据库的事务（慎选）</strong></p>
<ol>
<li><p><strong>修改事务隔离级别</strong></p>
<p>设置隔离级别命令 set [global/session] transaction isolation level xxxx; 如果使用 global 则修改的是数据库的默认隔离级别，所有新开的窗口的隔离级别继承自这个默认隔离级别如果使用 session 修改，则修改的是当前客户端的隔离级别，和数据库默认隔离级别无关。当前的客户端是什么隔离级别，就能防止什么隔离级别问题，和其他客户端是什么隔离级别无关。</p>
<p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-13-160434.png" alt=""></p>
<p><em>此时用最刚刚开始的代码查询，即使不更新事务依然可以查的到新添加的数据，打印输出，可以查到新更新的数据</em></p>
</li>
<li><p><strong>关闭数据库的事务（修改存储引擎）</strong></p>
<p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-13-160532.png" alt=""></p>
<p><em>再次用最刚刚开始的代码查询，此时跟事务已经没有什么关系了，可以查的到新添加的数据</em></p>
</li>
</ol>
<h3 id="数据库事务"><a href="#数据库事务" class="headerlink" title="数据库事务"></a>数据库事务</h3><p>事务指逻辑上的一组操作，组成这组操作的各个单元，要不全部成功，要不全部不成功</p>
<p><strong>事务特性：</strong></p>
<ul>
<li>原子性</li>
<li>一致性</li>
<li>隔离性</li>
<li>持久性</li>
</ul>
<p><strong>隔离性</strong>：</p>
<p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-13-161311.png" alt=""></p>
<p>其中“√”是该隔离级别会出现的问题，“✘”是该隔离级别解决的问题。</p>
<p><strong>脏读：</strong>一个事务读取到了另一个事务未提交的数据,这是特别危险的，要尽力防止。</p>
<p><strong>不可重复读</strong>：在一个事务内读取到另一个事务中更新的数据，多次读取结果不同</p>
<p><strong>幻读：</strong>是指在一个事务内读取到了别的事务插入的数据，导致前后读取不一致</p>
<h3 id="四个隔离级别"><a href="#四个隔离级别" class="headerlink" title="四个隔离级别"></a>四个隔离级别</h3><p><strong>Read Uncommitted(读取未提交内容)：</strong></p>
<p>所有事务都可以看到其他未提交事务的执行结果<br>本隔离级别很少用于实际应用，因为它的性能也不比其他级别好多少<br>该级别引发的问题是——脏读 (Dirty Read)：读取到了未提交的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"># 首先，修改隔离级别</span><br><span class="line"></span><br><span class="line">set tx_isolation=&apos;READ-UNCOMMITTED&apos;;</span><br><span class="line">select @@tx_isolation;</span><br><span class="line">+------------------+</span><br><span class="line">| @@tx_isolation   |</span><br><span class="line">+------------------+</span><br><span class="line">| READ-UNCOMMITTED |</span><br><span class="line">+------------------+</span><br><span class="line"># 事务A：启动一个事务</span><br><span class="line">start transaction;</span><br><span class="line">select * from tx;</span><br><span class="line">+------+------+</span><br><span class="line">| id   | num  |</span><br><span class="line">+------+------+</span><br><span class="line">|    1 |    1 |</span><br><span class="line">|    2 |    2 |</span><br><span class="line">|    3 |    3 |</span><br><span class="line">+------+------+</span><br><span class="line"># 事务B：也启动一个事务(那么两个事务交叉了)</span><br><span class="line"></span><br><span class="line">```</span><br><span class="line">   在事务B中执行更新语句，且不提交</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">start transaction;</span><br><span class="line">update tx set num=10 where id=1;</span><br><span class="line">select * from tx;</span><br><span class="line">+------+------+</span><br><span class="line">| id   | num  |</span><br><span class="line">+------+------+</span><br><span class="line">|    1 |   10 |</span><br><span class="line">|    2 |    2 |</span><br><span class="line">|    3 |    3 |</span><br><span class="line">+------+------+</span><br><span class="line"></span><br><span class="line"># 事务A：那么这时候事务A能看到这个更新了的数据吗?</span><br><span class="line"></span><br><span class="line">select * from tx;</span><br><span class="line">+------+------+</span><br><span class="line">| id   | num  |</span><br><span class="line">+------+------+</span><br><span class="line">|    1 |   10 |   ---&gt;可以看到！说明我们读到了事务B还没有提交的数据</span><br><span class="line">|    2 |    2 |</span><br><span class="line">|    3 |    3 |</span><br><span class="line">+------+------+</span><br><span class="line"></span><br><span class="line"># 事务B：事务B回滚,仍然未提交</span><br><span class="line"></span><br><span class="line">rollback;</span><br><span class="line">select * from tx;</span><br><span class="line">+------+------+</span><br><span class="line">| id   | num  |</span><br><span class="line">+------+------+</span><br><span class="line">|    1 |    1 |</span><br><span class="line">|    2 |    2 |</span><br><span class="line">|    3 |    3 |</span><br><span class="line">+------+------+</span><br><span class="line"></span><br><span class="line"># 事务A：在事务A里面看到的也是B没有提交的数据</span><br><span class="line"></span><br><span class="line">select * from tx;</span><br><span class="line">+------+------+</span><br><span class="line">| id   | num  |</span><br><span class="line">+------+------+</span><br><span class="line">|    1 |    1 |      ---&gt;脏读意味着我在这个事务中(A中)，事务B虽然没有提交，但它任何一条数据变化，我都可以看到！</span><br><span class="line">|    2 |    2 |</span><br><span class="line">|    3 |    3 |</span><br><span class="line">+------+------+</span><br><span class="line"></span><br><span class="line">READ-UNCOMMITTED</span><br></pre></td></tr></table></figure>
<p><strong>Read Committed(读取提交内容)：</strong></p>
<p><strong><em>这是大多数数据库系统的默认隔离级别（但不是 MySQL 默认的）</em></strong></p>
<p>它满足了隔离的简单定义：一个事务只能看见已经提交事务所做的改变<br>这种隔离级别出现的问题是——不可重复读 (Nonrepeatable Read)：不可重复读意味着我们在同一个事务中执行完全相同的 select 语句时可能看到不一样的结果。<br>导致这种情况的原因可能有：(1) 有一个交叉的事务有新的 commit，导致了数据的改变;(2) 一个数据库被多个实例操作时, 同一事务的其他实例在该实例处理其间可能会有新的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">#首先修改隔离级别</span><br><span class="line">set tx_isolation=&apos;read-committed&apos;;</span><br><span class="line">select @@tx_isolation;</span><br><span class="line">+----------------+</span><br><span class="line">| @@tx_isolation |</span><br><span class="line">+----------------+</span><br><span class="line">| READ-COMMITTED |</span><br><span class="line">+----------------+</span><br><span class="line"></span><br><span class="line">#事务A：启动一个事务</span><br><span class="line">start transaction;</span><br><span class="line">select * from tx;</span><br><span class="line">+------+------+</span><br><span class="line">| id   | num  |</span><br><span class="line">+------+------+</span><br><span class="line">|    1 |    1 |</span><br><span class="line">|    2 |    2 |</span><br><span class="line">|    3 |    3 |</span><br><span class="line">+------+------+</span><br><span class="line"></span><br><span class="line">#事务B：也启动一个事务(那么两个事务交叉了)</span><br><span class="line">       在这事务中更新数据，且未提交</span><br><span class="line">start transaction;</span><br><span class="line">update tx set num=10 where id=1;</span><br><span class="line">select * from tx;</span><br><span class="line">+------+------+</span><br><span class="line">| id   | num  |</span><br><span class="line">+------+------+</span><br><span class="line">|    1 |   10 |</span><br><span class="line">|    2 |    2 |</span><br><span class="line">|    3 |    3 |</span><br><span class="line">+------+------+</span><br><span class="line"></span><br><span class="line">#事务A：这个时候我们在事务A中能看到数据的变化吗?</span><br><span class="line">select * from tx; ---------------&gt;</span><br><span class="line">+------+------+                |</span><br><span class="line">| id   | num  |                |</span><br><span class="line">+------+------+                |</span><br><span class="line">|    1 |    1 |---&gt;并不能看到！  |</span><br><span class="line">|    2 |    2 |                |</span><br><span class="line">|    3 |    3 |                |</span><br><span class="line">+------+------+                |——&gt;相同的select语句，结果却不一样</span><br><span class="line">                               |</span><br><span class="line">#事务B：如果提交了事务B呢?         |</span><br><span class="line">commit;                        |</span><br><span class="line">                               |</span><br><span class="line">#事务A:                         |</span><br><span class="line">select * from tx; ---------------&gt;</span><br><span class="line">+------+------+</span><br><span class="line">| id   | num  |</span><br><span class="line">+------+------+</span><br><span class="line">|    1 |   10 |---&gt;因为事务B已经提交了，所以在A中我们看到了数据变化</span><br><span class="line">|    2 |    2 |</span><br><span class="line">|    3 |    3 |</span><br><span class="line">+------+------+</span><br><span class="line"></span><br><span class="line">READ-COMMITTED</span><br></pre></td></tr></table></figure>
<p><strong>Repeatable Read(可重读)：</strong></p>
<p><strong><em>这是 MySQL 的默认事务隔离级别</em></strong><br><strong><em>它确保同一事务的多个实例在并发读取数据时，会看到同样的数据行</em></strong><br>此级别可能出现的问题——幻读 (Phantom Read)：当用户读取某一范围的数据行时，另一个事务又在该范围内插入了新行，当用户再读取该范围的数据行时，会发现有新的 “幻影” 行<br>InnoDB 和 Falcon 存储引擎通过多版本并发控制 (MVCC，Multiversion Concurrency Control) 机制解决了该问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">#首先，更改隔离级别</span><br><span class="line">set tx_isolation=&apos;repeatable-read&apos;;</span><br><span class="line">select @@tx_isolation;</span><br><span class="line">+-----------------+</span><br><span class="line">| @@tx_isolation  |</span><br><span class="line">+-----------------+</span><br><span class="line">| REPEATABLE-READ |</span><br><span class="line">+-----------------+</span><br><span class="line"></span><br><span class="line">#事务A：启动一个事务</span><br><span class="line">start transaction;</span><br><span class="line">select * from tx;</span><br><span class="line">+------+------+</span><br><span class="line">| id   | num  |</span><br><span class="line">+------+------+</span><br><span class="line">|    1 |    1 |</span><br><span class="line">|    2 |    2 |</span><br><span class="line">|    3 |    3 |</span><br><span class="line">+------+------+</span><br><span class="line"></span><br><span class="line">#事务B：开启一个新事务(那么这两个事务交叉了)</span><br><span class="line">       在事务B中更新数据，并提交</span><br><span class="line">start transaction;</span><br><span class="line">update tx set num=10 where id=1;</span><br><span class="line">select * from tx;</span><br><span class="line">+------+------+</span><br><span class="line">| id   | num  |</span><br><span class="line">+------+------+</span><br><span class="line">|    1 |   10 |</span><br><span class="line">|    2 |    2 |</span><br><span class="line">|    3 |    3 |</span><br><span class="line">+------+------+</span><br><span class="line">commit;</span><br><span class="line"></span><br><span class="line">#事务A：这时候即使事务B已经提交了,但A能不能看到数据变化？</span><br><span class="line">select * from tx;</span><br><span class="line">+------+------+</span><br><span class="line">| id   | num  |</span><br><span class="line">+------+------+</span><br><span class="line">|    1 |    1 | ---&gt;还是看不到的！(这个级别2不一样，也说明级别3解决了不可重复读问题)</span><br><span class="line">|    2 |    2 |</span><br><span class="line">|    3 |    3 |</span><br><span class="line">+------+------+</span><br><span class="line"></span><br><span class="line">#事务A：只有当事务A也提交了，它才能够看到数据变化</span><br><span class="line">commit;</span><br><span class="line">select * from tx;</span><br><span class="line">+------+------+</span><br><span class="line">| id   | num  |</span><br><span class="line">+------+------+</span><br><span class="line">|    1 |   10 |</span><br><span class="line">|    2 |    2 |</span><br><span class="line">|    3 |    3 |</span><br><span class="line">+------+------+</span><br><span class="line"></span><br><span class="line">REPEATABLE-READ</span><br></pre></td></tr></table></figure>
<p><strong>Serializable(可串行化)：</strong></p>
<p>这是最高的隔离级别<br>它通过强制事务排序，使之不可能相互冲突，从而解决幻读问题。简言之, 它是在每个读的数据行上加上共享锁。<br>在这个级别，可能导致大量的超时现象和锁竞争</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#首先修改隔离界别</span><br><span class="line">set tx_isolation=&apos;serializable&apos;;</span><br><span class="line">select @@tx_isolation;</span><br><span class="line">+----------------+</span><br><span class="line">| @@tx_isolation |</span><br><span class="line">+----------------+</span><br><span class="line">| SERIALIZABLE   |</span><br><span class="line">+----------------+</span><br><span class="line"></span><br><span class="line">#事务A：开启一个新事务</span><br><span class="line">start transaction;</span><br><span class="line"></span><br><span class="line">#事务B：在A没有commit之前，这个交叉事务是不能更改数据的</span><br><span class="line">start transaction;</span><br><span class="line">insert tx values(&apos;4&apos;,&apos;4&apos;);</span><br><span class="line">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</span><br><span class="line">update tx set num=10 where id=1;</span><br><span class="line">ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</span><br><span class="line"></span><br><span class="line">SERIALIZABLE</span><br></pre></td></tr></table></figure>

        
      
    </div>

    

    

  </article>

      
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2018/12/15/python-基于-Pandas-数据处理/">python 基于 Pandas 数据处理</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2018-12-15
        </span>
        
        
      </div>
    </header>

    
    


    <div class="post-content">
      
        
        

        
          <p>项目中需要把实时采集到的环境监测数据，进行分类汇总，所以借助 Pandas 进行数据处理。</p>
<p>原始数据格式</p>
<p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-12-141510.png" alt="Snip20181212_1"></p>
<p>采集数据主要是 PM2.5、温度、湿度、甲醛，时间间隔是20秒左右。</p>
<p>需要统计的数据</p>
<ol>
<li>每天中截止统计时间PM2.5的最小值</li>
<li>获取4种类型的最新的采集数据</li>
<li>每个月的4种类型数据的平均值</li>
<li>每天中从早上8点开始，间隔1个小时的 PM2.5、温度、湿度数据</li>
</ol>
<h3 id="数据处理过程"><a href="#数据处理过程" class="headerlink" title="数据处理过程"></a>数据处理过程</h3><h4 id="初始化数据"><a href="#初始化数据" class="headerlink" title="初始化数据"></a>初始化数据</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame([[ij <span class="keyword">for</span> ij <span class="keyword">in</span> i] <span class="keyword">for</span> i <span class="keyword">in</span> data])</span><br><span class="line">df.columns = [<span class="string">'id'</span>, <span class="string">'uuid'</span>, <span class="string">'room'</span>, <span class="string">'pm25'</span>, <span class="string">'temp'</span>, <span class="string">'hum'</span>, <span class="string">'voc'</span>, <span class="string">'time'</span>]</span><br><span class="line">df = df.set_index(<span class="string">'time'</span>)<span class="comment"># 将date设置为index</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>data 是从数据库获取的所有数据</strong></p>
<h4 id="获取截止时间-PM2-5的最小值"><a href="#获取截止时间-PM2-5的最小值" class="headerlink" title="获取截止时间 PM2.5的最小值"></a>获取截止时间 PM2.5的最小值</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="comment"># 先获取当前月份</span></span><br><span class="line">&gt; now_time = datetime.datetime.now()</span><br><span class="line">&gt; <span class="comment"># print(now_time)</span></span><br><span class="line">&gt; month = now_time.strftime(<span class="string">'%Y-%m'</span>)</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="comment"># 当月最小的pm2.5，month='2018-12'</span></span><br><span class="line">&gt; pm25_min = df[month][<span class="string">'pm25'</span>].min()</span><br><span class="line">&gt; print(<span class="string">'pm25_min='</span> + pm25_min)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>以时间筛选之后，调用函数 min 获取’pm25’这列的最小值</strong></p>
<h4 id="获取4种类型最新的采集数据"><a href="#获取4种类型最新的采集数据" class="headerlink" title="获取4种类型最新的采集数据"></a>获取4种类型最新的采集数据</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 当前温度值</span></span><br><span class="line">cur_temp = df[<span class="string">'temp'</span>].values[<span class="number">0</span>]</span><br><span class="line"><span class="comment"># 当前湿度值</span></span><br><span class="line">cur_hum = df[<span class="string">'hum'</span>].values[<span class="number">0</span>]</span><br><span class="line"><span class="comment"># 当前 PM25值</span></span><br><span class="line">cur_pm25 = df[<span class="string">'pm25'</span>].values[<span class="number">0</span>]</span><br><span class="line"><span class="comment"># 当前 voc 值</span></span><br><span class="line">cur_voc = df[<span class="string">'voc'</span>].values[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<p><strong>获取某一列的第一个数据</strong></p>
<h4 id="每个月的4种类型数据的平均值"><a href="#每个月的4种类型数据的平均值" class="headerlink" title="每个月的4种类型数据的平均值"></a>每个月的4种类型数据的平均值</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 当月平均PM25</span></span><br><span class="line">pm25_sum = df[month][<span class="string">'pm25'</span>].apply(int).sum()</span><br><span class="line"><span class="comment"># print('month_pm25_sum = ' + str(pm25_sum))</span></span><br><span class="line">avg_pm25 = int(pm25_sum / df[month][<span class="string">'pm25'</span>].count())</span><br><span class="line">print(<span class="string">'avg_pm25 = '</span> + str(avg_pm25))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当月平均温度</span></span><br><span class="line">temp_sum = df[month][<span class="string">'temp'</span>].apply(int).sum()</span><br><span class="line"><span class="comment"># print('month_temp_sum = ' + str(temp_sum))</span></span><br><span class="line">avg_temp = int(temp_sum / df[month][<span class="string">'temp'</span>].count())</span><br><span class="line">print(<span class="string">'avg_temp = '</span> + str(avg_temp))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当月平均湿度</span></span><br><span class="line">hum_sum = df[month][<span class="string">'hum'</span>].apply(int).sum()</span><br><span class="line"><span class="comment"># print('month_hum_sum = ' + str(temp_sum))</span></span><br><span class="line">avg_hum = int(hum_sum / df[month][<span class="string">'hum'</span>].count())</span><br><span class="line">print(<span class="string">'avg_hum = '</span> + str(avg_hum))</span><br></pre></td></tr></table></figure>
<p><strong>当月所有数据总和除以数据项</strong></p>
<p>####每天中从早上8点开始，间隔1个小时的 PM2.5、温度、湿度数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">now_time = datetime.datetime.now()</span><br><span class="line"><span class="comment"># print(now_time)</span></span><br><span class="line">day = now_time.strftime(<span class="string">'%Y-%m-%d'</span>)</span><br><span class="line"></span><br><span class="line">temp_ar = []</span><br><span class="line">hum_ar = []</span><br><span class="line">pm25_ar = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>, <span class="number">16</span>):</span><br><span class="line">    <span class="keyword">if</span> i &lt; <span class="number">10</span>:</span><br><span class="line">        time = day + <span class="string">" 0"</span> + str(i)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        time = day + <span class="string">" "</span> + str(i)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        temp = df[time][<span class="string">'temp'</span>].values[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        temp = <span class="number">0</span></span><br><span class="line">    temp_ar.append(temp)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        hum = df[time][<span class="string">'hum'</span>].values[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        hum = <span class="number">0</span></span><br><span class="line">    hum_ar.append(hum)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        pm25 = df[time][<span class="string">'pm25'</span>].values[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        pm25 = <span class="number">0</span></span><br><span class="line">    pm25_ar.append(pm25)</span><br></pre></td></tr></table></figure>
<p><strong>获取日期到天，然后加上时间’2018-12-12 08’的格式筛选出某个时间点第一个数据</strong></p>
<h3 id="用到的技术点"><a href="#用到的技术点" class="headerlink" title="用到的技术点"></a>用到的技术点</h3><h4 id="Pandas-日期数据处理"><a href="#Pandas-日期数据处理" class="headerlink" title="Pandas 日期数据处理"></a>Pandas 日期数据处理</h4><h5 id="按日期筛选数据"><a href="#按日期筛选数据" class="headerlink" title="按日期筛选数据"></a>按日期筛选数据</h5><ol>
<li><p><strong>按年度获取数据</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">`print(<span class="string">'---------获取2018年的数据-----------'</span>)`</span><br><span class="line">`print(df[<span class="string">'2018'</span>].head(<span class="number">2</span>)) <span class="comment"># 获取2018年的数据前两条`</span></span><br><span class="line">`print(df[<span class="string">'2018'</span>].tail(<span class="number">2</span>)) <span class="comment"># 获取2018年的数据后两条</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>获取跨年数据</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">'---------获取2017至2018年的数据-----------'</span>)</span><br><span class="line">print(df[<span class="string">'2017'</span>:<span class="string">'2018'</span>].head(<span class="number">2</span>))  <span class="comment">#获取2016至2017年的数据</span></span><br><span class="line">print(df[<span class="string">'2017'</span>:<span class="string">'2018'</span>].tail(<span class="number">2</span>))  <span class="comment">#获取2016至2017年的数据</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>获取某月数据</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">'---------获取某月的数据-----------'</span>)</span><br><span class="line">print(df[<span class="string">'2018-12'</span>]) <span class="comment"># 获取某月的数据</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>获取某天的数据</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按日期筛选数据</span></span><br><span class="line">print(<span class="string">'---------获取具体某天的数据-----------'</span>)</span><br><span class="line"><span class="comment"># 获取具体某天的数据</span></span><br><span class="line">print(df[<span class="string">'2018-12-12'</span>])</span><br><span class="line"><span class="comment"># 可以考虑用区间来获取某天的数据</span></span><br><span class="line">print(df[<span class="string">'2018-12-11'</span>:<span class="string">'2018-12-12'</span>])</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>获取某个时期之前或之后的数据</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dataframe的truncate函数可以获取某个时期之前或之后的数据，或者某个时间区间的数据</span></span><br><span class="line"><span class="comment"># 但一般建议直接用切片（slice），这样更为直观，方便</span></span><br><span class="line">print(<span class="string">'---------获取某个时期之前或之后的数据-----------'</span>)</span><br><span class="line">print(<span class="string">'--------after------------'</span>)</span><br><span class="line">print(df.truncate(after = <span class="string">'2018-11'</span>))</span><br><span class="line">print(<span class="string">'--------before------------'</span>)</span><br><span class="line">print(df.truncate(before=<span class="string">'2018-12'</span>))</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>获取某个时间点的数据</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">'---------获取某个时间点的数据-----------'</span>)</span><br><span class="line">print(df[<span class="string">'2018-12-12 10'</span>]) <span class="comment"># 获取12月12日，10点的数据</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="pd-DataFrame-统计各列数值多少"><a href="#pd-DataFrame-统计各列数值多少" class="headerlink" title="pd.DataFrame 统计各列数值多少"></a>pd.DataFrame 统计各列数值多少</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">.count()          <span class="comment">#非空元素计算</span></span><br><span class="line">.min()   a         <span class="comment">#最小值</span></span><br><span class="line">.max()            <span class="comment">#最大值</span></span><br><span class="line">.idxmin()         <span class="comment">#最小值的位置，类似于R中的which.min函数</span></span><br><span class="line">.idxmax()         <span class="comment">#最大值的位置，类似于R中的which.max函数</span></span><br><span class="line">.quantile(<span class="number">0.75</span>)    <span class="comment">#75%分位数</span></span><br><span class="line">.sum()            <span class="comment">#求和</span></span><br><span class="line">.mean()           <span class="comment">#均值</span></span><br><span class="line">.median()         <span class="comment">#中位数</span></span><br><span class="line">.mode()           <span class="comment">#众数</span></span><br><span class="line">.var()            <span class="comment">#方差</span></span><br><span class="line">.std()            <span class="comment">#标准差</span></span><br><span class="line">.mad()            <span class="comment">#平均绝对偏差</span></span><br><span class="line">.skew()           <span class="comment">#偏度</span></span><br><span class="line">.kurt()           <span class="comment">#峰度</span></span><br><span class="line">.describe()       <span class="comment">#一次性输出多个描述性统计指标</span></span><br></pre></td></tr></table></figure>
<h5 id="将-pandas-数据帧中的列从-int-转换为字符串"><a href="#将-pandas-数据帧中的列从-int-转换为字符串" class="headerlink" title="将 pandas 数据帧中的列从 int 转换为字符串"></a>将 pandas 数据帧中的列从 int 转换为字符串</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df[<span class="string">'A'</span>].apply(str)</span><br></pre></td></tr></table></figure>
<p>将 <strong>int</strong>转化为<strong>str</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df[month][<span class="string">'pm25'</span>].apply(int)</span><br></pre></td></tr></table></figure>
<p>将 <strong>str</strong>转化为<strong>int</strong></p>

        
      
    </div>

    

    

  </article>

      
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2018/12/15/使用-supervisor-管理进程/">使用 supervisor 管理进程</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2018-12-15
        </span>
        
        
      </div>
    </header>

    
    


    <div class="post-content">
      
        
        

        
          <p>Supervisor (<a href="http://supervisord.org/" target="_blank" rel="noopener">http://supervisord.org</a>) 是一个用 Python 写的进程管理工具，可以很方便的用来启动、重启、关闭进程（不仅仅是 Python 进程）。除了对单个进程的控制，还可以同时启动、关闭多个进程，比如很不幸的服务器出问题导致所有应用程序都被杀死，此时可以用 supervisor 同时启动所有应用程序而不是一个一个地敲命令启动。</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>服务器我采用的是 Ubuntu 系统，所以使用 apt-get 安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install supervisor</span><br></pre></td></tr></table></figure>
<h3 id="supervisor-配置"><a href="#supervisor-配置" class="headerlink" title="supervisor 配置"></a>supervisor 配置</h3><p>安装完成之后，配置文件在 Ubuntu 系统中的位置是 <strong>/etc/supervisor/supervisor.conf</strong>，如果配置文件不存在，可以使用命令<strong>echo supervisord_conf</strong>命令输出默认配置，也可以重定向到一个配置文件里：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo_supervisord_conf &gt; /etc/supervisord.conf</span><br></pre></td></tr></table></figure>
<p>可以看看主要的配置选项</p>
<p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-13-152146.png" alt=""></p>
<h3 id="添加自己的程序"><a href="#添加自己的程序" class="headerlink" title="添加自己的程序"></a>添加自己的程序</h3><p>对应的配置文件可能是：(每行配置结束的“；”一定要和配置项保持分开)</p>
<p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-13-152305.png" alt=""></p>
<p>其中 <code>[program:iot]</code> 中的 <code>iot</code> 是应用程序的唯一标识，不能重复。对该程序的所有操作（start, restart 等）都通过名字来实现。</p>
<h3 id="web-管理界面"><a href="#web-管理界面" class="headerlink" title="web 管理界面"></a>web 管理界面</h3><p>可以配置 supervisrod 启动 web 管理界面，这个 web 后台使用 Basic Auth 的方式进行身份认证。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">;[inet_http_server]         ; HTTP 服务器，提供 web 管理界面</span><br><span class="line">;port=9001        			; Web 管理后台运行的 IP 和端口，如果开放到公网，需要注意安全性</span><br><span class="line">;username=user              ; 登录管理后台的用户名</span><br><span class="line">;password=123               ; 登录管理后台的密码</span><br></pre></td></tr></table></figure>
<p>可以在 web 上，控制任务的启动、停止、重启、清除日志，查看最新的日志记录。</p>
<p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-13-143910.png" alt=""></p>
<h3 id="使用-supervisorctl"><a href="#使用-supervisorctl" class="headerlink" title="使用 supervisorctl"></a>使用 supervisorctl</h3><p>Supervisorctl 是 supervisord 的一个命令行客户端工具，启动时需要指定与 supervisord 使用同一份配置文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supervisorctl -c /etc/supervisord/supervisord.conf</span><br></pre></td></tr></table></figure>
<p>上面这个命令会进入 supervisorctl 的 shell 界面，然后可以执行不同的命令了：</p>
<blockquote>
<p><img src="http://wzhicoder-mk-pic.oss-cn-beijing.aliyuncs.com/mk/2018-12-15-125846.png" alt=""></p>
</blockquote>

        
      
    </div>

    

    

  </article>

      
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2018/12/15/hello-world/">Hello World</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2018-12-15
        </span>
        
        
      </div>
    </header>

    
    


    <div class="post-content">
      
        
        

        
          <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

        
      
    </div>

    

    

  </article>

      
      
  <nav class="pagination">
    
    
  </nav>


    
  </section>

          </div>
          

        </div>
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:your@email.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          <a href="https://github.com/wzhicoder" class="iconfont icon-github" title="github"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    
      
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>



<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://hexo.io/">Hexo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
     
      2015 - 
    
    2018

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">PP小猪</span>
  </span>
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    


    
  



  
  





  
    <script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  

  
    <script type="text/javascript" src="/lib/pjax/jquery.pjax.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/nprogress/nprogress.min.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=2.10.1"></script>

  </body>
</html>
